From 2f8b69b4c1a3af6b42aa3cf72195f45519c83c97 Mon Sep 17 00:00:00 2001
From: Gabriele C <sgdc3.mail@gmail.com>
Date: Tue, 10 Oct 2017 15:52:46 -0400
Subject: [PATCH] Add setting for proxy online mode status


diff --git a/src/main/java/com/destroystokyo/paper/PaperConfig.java b/src/main/java/com/destroystokyo/paper/PaperConfig.java
index 011cbf5..cf06f8a 100644
--- a/src/main/java/com/destroystokyo/paper/PaperConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperConfig.java
@@ -230,4 +230,9 @@ public class PaperConfig {
     private static void saveEmptyScoreboardTeams() {
         saveEmptyScoreboardTeams = getBoolean("settings.save-empty-scoreboard-teams", false);
     }
+
+    public static boolean bungeeOnlineMode = true;
+    private static void bungeeOnlineMode() {
+        bungeeOnlineMode = getBoolean("settings.bungee-online-mode", true);
+    }
 }
diff --git a/src/main/java/net/minecraft/server/management/PreYggdrasilConverter.java b/src/main/java/net/minecraft/server/management/PreYggdrasilConverter.java
index 2544da8..4f96adb 100644
--- a/src/main/java/net/minecraft/server/management/PreYggdrasilConverter.java
+++ b/src/main/java/net/minecraft/server/management/PreYggdrasilConverter.java
@@ -75,7 +75,7 @@ public class PreYggdrasilConverter {
                                         }),
                                 String.class);
 
-        if (!server.isServerInOnlineMode() && !SpigotConfig.bungee) {
+        if (!server.isServerInOnlineMode() && (!SpigotConfig.bungee && !com.destroystokyo.paper.PaperConfig.bungeeOnlineMode)) { // Paper - Handle via setting
             for (String s : astring) {
                 UUID uuid = EntityPlayer.getUUID(new GameProfile((UUID) null, s));
                 GameProfile gameprofile = new GameProfile(uuid, s);
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index a32550a..ccfbd6f 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -1411,7 +1411,8 @@ public final class CraftServer implements Server {
         if (result == null) {
             GameProfile profile = null;
 
-            if (MinecraftServer.getServer().isServerInOnlineMode() || SpigotConfig.bungee) {
+            if (MinecraftServer.getServer().isServerInOnlineMode()
+                    || (SpigotConfig.bungee && com.destroystokyo.paper.PaperConfig.bungeeOnlineMode)) { // Paper - Handle via setting
                 profile = this.console.getPlayerProfileCache().getGameProfileForUsername(name);
             }
 
-- 
2.18.0

