From 442585a866d57cf11bff6c6c8d28f6e92e7267f2 Mon Sep 17 00:00:00 2001
From: vemacs <d@nkmem.es>
Date: Tue, 10 Oct 2017 17:33:15 -0400
Subject: [PATCH] Optimize Network Queue


diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index f1952d4..acb0846 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -161,7 +161,7 @@ public abstract class MinecraftServer implements ICommandSender, Runnable, IThre
     private final GameProfileRepository profileRepo;
     private final PlayerProfileCache profileCache;
     private long nanoTimeSinceStatusRefresh;
-    protected final Queue<FutureTask<?>> futureTaskQueue = new ConcurrentLinkedQueue<FutureTask<?>>();
+    protected final Queue<FutureTask<?>> futureTaskQueue = new com.destroystokyo.paper.utils.CachedSizeConcurrentLinkedQueue<>(); // Paper - Make size() constant-time
     private Thread serverThread;
     private long currentTime = getCurrentTimeMillis();
     public List<WorldServer> worlds = new ArrayList<WorldServer>();
-- 
2.18.0

