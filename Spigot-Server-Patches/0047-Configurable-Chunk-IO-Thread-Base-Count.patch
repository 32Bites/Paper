From 42c1d8f95f4f3e08ddfc429dc7c5d6565ddf4b9c Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Wed, 27 Sep 2017 14:49:06 -0400
Subject: [PATCH] Configurable Chunk IO Thread Base Count


diff --git a/src/main/java/com/destroystokyo/paper/PaperConfig.java b/src/main/java/com/destroystokyo/paper/PaperConfig.java
index b5795b6..36689db 100644
--- a/src/main/java/com/destroystokyo/paper/PaperConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperConfig.java
@@ -199,4 +199,9 @@ public class PaperConfig {
                 " - Interval: " + timeSummary(Timings.getHistoryInterval() / 20) +
                 " - Length: " + timeSummary(Timings.getHistoryLength() / 20));
     }
+
+    public static int minChunkLoadThreads = 2;
+    private static void chunkLoadThreads() {
+        minChunkLoadThreads = Math.min(6, getInt("settings.min-chunk-load-threads", 2)); // Keep people from doing stupid things with max of 6
+    }
 }
diff --git a/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOExecutor.java b/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOExecutor.java
index a2b4ebf..53c9945 100644
--- a/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOExecutor.java
+++ b/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOExecutor.java
@@ -7,7 +7,7 @@ import net.minecraft.world.gen.ChunkProviderServer;
 import org.bukkit.craftbukkit.util.AsynchronousExecutor;
 
 public class ChunkIOExecutor {
-    static final int BASE_THREADS = 1;
+    static final int BASE_THREADS = com.destroystokyo.paper.PaperConfig.minChunkLoadThreads; // Paper
     static final int PLAYERS_PER_THREAD = 50;
     private static final AsynchronousExecutor<QueuedChunk, Chunk, Runnable, RuntimeException> instance =
             new AsynchronousExecutor<QueuedChunk, Chunk, Runnable, RuntimeException>(new ChunkIOProvider(), 1);
-- 
2.18.0

